<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<ui:composition template="template/maintemplate.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:define name="centerReplace">
        <f:metadata>
            <f:viewParam name="selectedProductId" value="#{productController.selectedProductId}" />
        </f:metadata>
        #{productController.reset()}
        <h:form id="productTableForm" >
            <div >
                <p:commandButton value="New Product"
                                 update=":addProductForm"
                                 actionListener="#{productController.onCreate()}"
                                 onsuccess="addProductDialog.show()"/>
            </div>
            <div style="height: 10px"/>
            <div style="width: 80%">
                <p:selectOneButton id="filterBox" 
                                   value="#{productController.selectedLabel}" >
                    <f:ajax listener="#{productController.filterProductCategories()}"
                            execute="@this"
                            render="productTable" 
                            event="change"/>
                    <f:selectItems value="#{productController.selectedLabels}"
                                   var="item"
                                   itemLabel="#{item}"
                                   itemValue="#{item}" />
                </p:selectOneButton>
            </div>
            <div style="height: 10px"/>
            <p:inputText />
            <div style="height: 10px"/>
            <p:dataTable id="productTable" 
                         value="#{productController.products}" 
                         var="item">

                <p:column headerText="ProductId">#{item.id}</p:column>
                <p:column headerText="name"
                          sortBy="#{item.name}">#{item.name}</p:column>
                <p:column headerText="cost" filterBy="#{item.cost}"
                          filterValue="#{productController.selectedLabels}"
                          sortBy="#{item.cost}">
                    
                    #{item.cost}</p:column>
                <p:column headerText="basePrice"
                          sortBy="#{item.basePrice}">#{item.basePrice}</p:column>
                <p:column headerText="expectPrice"
                          sortBy="#{item.expectPrice}">#{item.expectPrice}</p:column>
                <p:column headerText="remain"></p:column>
                <p:column headerText="Category" 
                          filterMatchMode="contains"
                          filterBy="#{item.category.name}" >
                    <h:outputText value="#{item.category.name}" />
                </p:column>
                <p:column headerText="action">
                    <p:commandButton icon="ui-icon-pencil"
                                     actionListener="#{productController.onSelect()}" 
                                     update=":editProductForm"
                                     onsuccess="editProductDialog.show()">
                        <f:param name="selectedProductId" value="#{item.id}"/>
                    </p:commandButton> 
                    <h:outputText value="  "/>
                    <p:commandButton icon="ui-icon-trash"
                                     actionListener="#{productController.onSelect()}"
                                     update=":removeProductForm"
                                     onsuccess="removeProductDialog.show()">
                        <f:param name="selectedProductId" value="#{item.id}"/>
                    </p:commandButton> 
                </p:column>
            </p:dataTable>
        </h:form>

        <p:dialog widgetVar="addProductDialog">
            <h:form id="addProductForm">
                <h:outputText value="Add new product" />
                <div style="height: 5px"/>
                <p:panelGrid columns="4">
                    <h:outputText value="Id"/>
                    <p:inputText value="#{productController.product.id}"/>

                    <h:outputText value="Name"/>
                    <p:inputText value="#{productController.product.name}"/>

                    <h:outputText value="cost"/>
                    <p:inputText value="#{productController.product.cost}"/>

                    <h:outputText value="basePrice"/>
                    <p:inputText value="#{productController.product.basePrice}"/>

                    <h:outputText value="expectPrice"/>
                    <p:inputText value="#{productController.product.expectPrice}"/>

                    <h:outputText value="category"/>
                    <p:selectOneMenu value="#{productController.product.category.id}">
                        <f:selectItems value="#{productController.categories}"
                                       var="item"
                                       itemLabel="#{item.name}"
                                       itemValue="#{item.id}"/>
                    </p:selectOneMenu>
                </p:panelGrid>
                <div style="height: 5px"/>
                <p:commandButton value="save"
                                 actionListener="#{productController.onSave()}"
                                 update=":productTableForm,:notification"
                                 onsuccess="addProductDialog.hide()"/>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="editProductDialog">
            <h:form id="editProductForm">
                <p:commandButton value="save"
                                 actionListener="#{productController.onSave()}"
                                 update=":productTableForm,:notification"
                                 onsuccess="editProductDialog.hide()"/>
                <p:panelGrid columns="4">
                    <h:outputText value="Id"/>
                    <p:inputText value="#{productController.product.id}"/>

                    <h:outputText value="Name"/>
                    <p:inputText value="#{productController.product.name}"/>

                    <h:outputText value="cost"/>
                    <p:inputText value="#{productController.product.cost}"/>

                    <h:outputText value="basePrice"/>
                    <p:inputText value="#{productController.product.basePrice}"/>

                    <h:outputText value="expectPrice"/>
                    <p:inputText value="#{productController.product.expectPrice}"/>

                    <h:outputText value="category"/>
                    <p:selectOneMenu value="#{productController.product.category.id}">
                        <f:selectItems value="#{productController.categories}"
                                       var="item"
                                       itemLabel="#{item.name}"
                                       itemValue="#{item.id}"
                                       />
                    </p:selectOneMenu>
                </p:panelGrid>
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="removeProductDialog">
            <h:form id="removeProductForm">
                <h:outputText value="Remove this product?"/>
                <p:inputText value="#{productController.product.name}"/>

                <p:commandButton value="remove"
                                 actionListener="#{productController.onRemove()}"                               
                                 update=":productTableForm,:notification"
                                 onsuccess="removeProductDialog.hide()"/>
            </h:form>
        </p:dialog>

    </ui:define>
</ui:composition>
